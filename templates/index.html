<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ì„±ê· ê´€ëŒ€ ìº í¼ìŠ¤ í¸ì˜ì‹œì„¤ ì •ë³´</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <div class="container">
      <h1>ì„±ê· ê´€ëŒ€ ìº í¼ìŠ¤<br />í¸ì˜ì‹œì„¤ ì •ë³´</h1>
      <script>
        function validateForm() {
          const building = document.querySelector(
            'select[name="building"]'
          ).value;
          const anyChecked = [
            ...document.querySelectorAll('input[type="checkbox"]'),
          ].some((cb) => cb.checked);

          // if (!building && !anyChecked) {
          //   alert("ê²€ìƒ‰í•  ê±´ë¬¼ ë˜ëŠ” í¸ì˜ì‹œì„¤ì„ ì„ íƒí•˜ì„¸ìš”!");
          //   return false;
          // }
          return true;
        }
      </script>

      <form method="GET" action="/" onsubmit="return validateForm()">
        <select name="building">
          <option value="">ê±´ë¬¼ ì„ íƒ</option>
          {% for f in facilities %}
          <option value="{{ f.building_name }}">{{ f.building_name }}</option>
          {% endfor %}
        </select>

        <div class="checkbox-group">
          <label><input type="checkbox" name="ramp" /> ê²½ì‚¬ë¡œ</label>
          <label><input type="checkbox" name="toilet" /> ì¥ì• ì¸ í™”ì¥ì‹¤</label>
          <label
            ><input type="checkbox" name="elevator" /> ì¥ì• ì¸ ì—˜ë¦¬ë² ì´í„°</label
          >
          <label><input type="checkbox" name="handrail" /> í•¸ë“œë ˆì¼</label>
        </div>

        <button type="submit">ê²€ìƒ‰</button>
      </form>

      {% if result %}
      <div id="result-box" class="result-box">
        <!-- <button
          onclick="document.getElementById('result-box').style.display='none'"
          class="close-btn"
        >
          Ã—
        </button> -->
        <div class="result-header">
          <h3>{{ result.building }}ì˜ í¸ì˜ì‹œì„¤ ì •ë³´</h3>
          {% if photo_list %}
          <button onclick="showPhotos()" class="photo-btn" title="ì‚¬ì§„ ë³´ê¸°">
            ğŸ“·
          </button>
          {% endif %}
        </div>

        {% for key, value in result.results.items() %}
        <p>
          {% if value %} âœ… {{ key | facility_name }} ìˆìŒ {% else %} âŒ {{ key
          | facility_name }} ì—†ìŒ {% endif %}
        </p>
        {% endfor %}
      </div>
      {% endif %}

      <div id="photo-modal" class="modal" style="display: none">
        <div class="modal-content">
          <span class="close-btn" onclick="hidePhotos()">Ã—</span>

          <!-- ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ -->
          <img
            id="slide-image"
            src=""
            style="max-width: 100%; max-height: 400px"
          />

          <!-- ì¢Œìš° ë²„íŠ¼ -->
          <div class="slide-controls">
            <button onclick="prevPhoto()">â—€ï¸</button>
            <button onclick="nextPhoto()">â–¶ï¸</button>
          </div>
        </div>
      </div>

      <div class="map-preview">
        <a href="/map">
          <img src="/static/map_placeholder.png" alt="ì§€ë„ ë¯¸ë¦¬ë³´ê¸°" />
        </a>
      </div>

      <a href="/report" class="report-button">ì œë³´í•˜ê¸°</a>
    </div>
  </body>

  <script>
    function showPhotos() {
      document.getElementById("photo-modal").style.display = "block";
    }
    function hidePhotos() {
      document.getElementById("photo-modal").style.display = "none";
    }
  </script>
  <script>
    const photos = [
      {% for photo in photo_list %}
        "{{ url_for('static', filename='building_photos/' ~ photo) }}"{% if not loop.last %},{% endif %}
      {% endfor %}
    ];
    let currentIndex = 0;

    function showPhotos() {
      if (photos.length > 0) {
        currentIndex = 0;
        document.getElementById("slide-image").src = photos[currentIndex];
        document.getElementById("photo-modal").style.display = "block";
      }
    }

    function hidePhotos() {
      document.getElementById("photo-modal").style.display = "none";
    }

    function nextPhoto() {
      currentIndex = (currentIndex + 1) % photos.length;
      document.getElementById("slide-image").src = photos[currentIndex];
    }

    function prevPhoto() {
      currentIndex = (currentIndex - 1 + photos.length) % photos.length;
      document.getElementById("slide-image").src = photos[currentIndex];
    }
  </script>
</html>
